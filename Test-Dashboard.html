<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheelio Test Dashboard</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* --- Basic Setup & Theming --- */
        :root {
            --bg-color: #1a1a2e;
            --card-bg-color: #16213e;
            --text-color: #e0e0e0;
            --primary-color: #0f3460;
            --accent-color: #e94560;
            --active-glow: #52cffe;
            --warning-glow: #e94560;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        /* --- Main Layout --- */
        .dashboard-container {
            width: 100%;
            max-width: 1200px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        header h1 {
            margin: 0;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        header h1 .fa-dharmachakra {
            color: var(--active-glow);
            animation: gentle-spin 20s linear infinite;
            font-size: 1.2em;
        }

        @keyframes gentle-spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #last-updated {
            font-size: 0.9em;
            color: #a0a0a0;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        /* --- Card Styling --- */
        .card {
            background-color: var(--card-bg-color);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--primary-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            margin: 0 0 20px 0;
            text-align: center;
            color: white;
        }

        /* --- Actuator Component Styling --- */
        .actuators-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 100%;
        }

        .actuator-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .actuator-item .icon {
            font-size: 2.5em;
            color: #4a5578;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        .actuator-item.active .icon-buzzer { color: var(--warning-glow); text-shadow: 0 0 15px var(--warning-glow); }
        .actuator-item.active .icon-warning { color: var(--warning-glow); text-shadow: 0 0 15px var(--warning-glow); }
        .actuator-item.active .icon-fog { color: var(--active-glow); text-shadow: 0 0 15px var(--active-glow); }
        
        .actuator-item span {
            font-weight: 500;
        }

        /* --- Sensor Value Component Styling --- */
        .sensor-value {
            font-size: 2.8em;
            font-weight: 700;
            text-align: center;
            margin: auto 0;
            color: white;
        }
        .sensor-value .unit {
            font-size: 0.5em;
            font-weight: 400;
            color: var(--text-color);
        }

        /* --- Inclination (Tilt) Component Styling --- */
        .tilt-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .bicycle-visualizer {
            width: 150px;
            height: 150px;
            border: 3px solid var(--primary-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, var(--bg-color) 0%, var(--card-bg-color) 100%);
            position: relative;
            overflow: hidden;
        }

        .bike-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
            transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            /* Convert black bike to match our active-glow color (#52cffe) */
            filter: 
                invert(1) /* Invert black to white */
                sepia(1) /* Add sepia for color manipulation */
                saturate(3) /* Increase saturation */
                hue-rotate(190deg) /* Rotate hue to cyan-blue range */
                brightness(1.1) /* Brighten to match our theme */
                contrast(1.3) /* Add contrast for clarity */
                drop-shadow(0 0 15px var(--active-glow)); /* Glowing effect */
            z-index: 2;
            position: relative;
        }

        .reference-line {
            position: absolute;
            background-color: var(--active-glow);
            opacity: 0.6;
            z-index: 1;
        }

        .horizontal-line {
            width: 120px;
            height: 2px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .vertical-line {
            width: 2px;
            height: 120px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Tilt Container for External Labels */
        .tilt-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            position: relative;
        }

        /* Direction Labels */
        .direction-label {
            font-size: 0.8em;
            font-weight: bold;
            color: var(--active-glow);
            opacity: 0.8;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
            white-space: nowrap;
        }

        /* Roll (Side Tilt) Labels - Left and Right of circle */
        .left-label, .right-label {
            display: flex;
            align-items: center;
            min-width: 35px;
            justify-content: center;
        }

        /* Pitch (Front/Back Tilt) Labels - Left (BACK) and Right (FRONT) of circle */
        .back-label, .front-label {
            display: flex;
            align-items: center;
            min-width: 40px;
            justify-content: center;
        }

        .tilt-value {
            font-size: 1.5em;
            font-weight: 600;
        }

        /* --- Warning Message Styling --- */
        #warning-card {
            grid-column: 1 / -1; /* Span full width */
            border-color: transparent;
            background-color: transparent;
            text-align: center;
            min-height: 50px;
            justify-content: center;
        }
        
        #warning-card.has-warning {
             background-color: #5d1c28;
             border-color: var(--accent-color);
        }

        #warning-message {
            font-size: 1.3em;
            font-weight: bold;
            color: white;
            margin: 0;
        }

        #warning-message i {
            margin-right: 10px;
        }

        #warning-message .fa-check-circle {
            color: #52cffe;
        }

        #warning-message .fa-exclamation-triangle {
            color: var(--accent-color);
        }

        /* --- Demo Controls --- */
        .demo-controls {
            background-color: var(--card-bg-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--primary-color);
            text-align: center;
        }

        .demo-controls h3 {
            margin: 0 0 15px 0;
            color: var(--active-glow);
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-btn {
            background-color: var(--primary-color);
            color: white;
            border: 1px solid var(--active-glow);
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .control-btn:hover {
            background-color: var(--active-glow);
            color: var(--bg-color);
        }

        .control-btn.active {
            background-color: var(--active-glow);
            color: var(--bg-color);
        }

        /* --- Live Button Styling --- */
        .live-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: var(--warning-glow);
            border: 1px solid var(--warning-glow);
            border-radius: 25px;
            padding: 8px 16px;
            text-decoration: none;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .live-button:hover {
            background-color: var(--warning-glow);
            color: var(--bg-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
        }

        .live-button i {
            font-size: 0.9em;
        }

    </style>
</head>
<body>

    <!-- Live Button -->
    <a href="index.html" class="live-button" title="Open Live Dashboard with Firebase Data">
        <i class="fas fa-broadcast-tower"></i>
        Live
    </a>

    <div class="dashboard-container">
        <header>
            <h1><i class="fas fa-dharmachakra"></i> Wheelio Test Dashboard</h1>
            <p id="last-updated">Demo Mode - JavaScript Generated Data</p>
        </header>

        <!-- Demo Controls -->
        <div class="demo-controls">
            <h3><i class="fas fa-cogs"></i> Demo Controls</h3>
            <div class="control-buttons">
                <button id="start-btn" class="control-btn active">Start Demo</button>
                <button id="stop-btn" class="control-btn">Stop Demo</button>
                <button id="scenario-btn" class="control-btn">Run Scenarios</button>
                <button id="random-btn" class="control-btn">Random Data</button>
            </div>
        </div>

        <div class="grid-container">
            <!-- Actuators Card -->
            <div class="card">
                <h3 class="card-title">Actuator Status</h3>
                <div class="actuators-container">
                    <div id="buzzer-status" class="actuator-item">
                        <i class="fas fa-bell icon icon-buzzer"></i>
                        <span>Buzzer</span>
                    </div>
                    <div id="warning-light-status" class="actuator-item">
                        <i class="fas fa-lightbulb icon icon-warning"></i>
                        <span>Warning Light</span>
                    </div>
                    <div id="fog-light-status" class="actuator-item">
                        <i class="fas fa-cloud-sun icon icon-fog"></i>
                        <span>Fog Light</span>
                    </div>
                </div>
            </div>

            <!-- Side to Side Tilt (Roll) -->
            <div class="card">
                <h3 class="card-title">Side Tilt (Roll)</h3>
                <div class="tilt-display">
                    <div class="tilt-container">
                        <div class="direction-label left-label">LEFT</div>
                        <div class="bicycle-visualizer">
                            <div class="reference-line vertical-line"></div>
                            <img id="roll-bicycle" src="assets/images/bike-front.png" alt="Bike Front View" class="bike-image">
                        </div>
                        <div class="direction-label right-label">RIGHT</div>
                    </div>
                    <div id="roll-value" class="tilt-value">0.00°</div>
                </div>
            </div>

            <!-- Front/Back Tilt (Pitch) -->
            <div class="card">
                <h3 class="card-title">Front/Back Tilt (Pitch)</h3>
                <div class="tilt-display">
                    <div class="tilt-container">
                        <div class="direction-label back-label">BACK</div>
                        <div class="bicycle-visualizer">
                            <div class="reference-line horizontal-line"></div>
                            <img id="pitch-bicycle" src="assets/images/bike-side.png" alt="Bike Side View" class="bike-image">
                        </div>
                        <div class="direction-label front-label">FRONT</div>
                    </div>
                    <div id="pitch-value" class="tilt-value">0.00°</div>
                </div>
            </div>
            
            <!-- Other Sensors -->
            <div class="card">
                <h3 class="card-title">Lidar Distance</h3>
                <p id="lidar-value" class="sensor-value">0.00 <span class="unit">m</span></p>
            </div>

            <div class="card">
                <h3 class="card-title">Ambient Light</h3>
                <p id="light-value" class="sensor-value">0 <span class="unit">lux</span></p>
            </div>

            <div class="card">
                <h3 class="card-title">Acceleration (X)</h3>
                <p id="accel-value" class="sensor-value">0.00 <span class="unit">m/s²</span></p>
            </div>
            
            <!-- Warning Message -->
            <div id="warning-card" class="card">
                <p id="warning-message"><i class="fas fa-check-circle"></i> System nominal.</p>
            </div>

        </div>
    </div>

    <script>
        // --- DEMO DATA GENERATOR ---
        
        // DOM Element References
        const lastUpdatedEl = document.getElementById('last-updated');
        
        const buzzerStatus = document.getElementById('buzzer-status');
        const warningLightStatus = document.getElementById('warning-light-status');
        const fogLightStatus = document.getElementById('fog-light-status');
        
        const rollBicycle = document.getElementById('roll-bicycle');
        const rollValue = document.getElementById('roll-value');
        const pitchBicycle = document.getElementById('pitch-bicycle');
        const pitchValue = document.getElementById('pitch-value');

        const lidarValue = document.getElementById('lidar-value');
        const lightValue = document.getElementById('light-value');
        const accelValue = document.getElementById('accel-value');
        
        const warningCard = document.getElementById('warning-card');
        const warningMessage = document.getElementById('warning-message');

        // Control buttons
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const scenarioBtn = document.getElementById('scenario-btn');
        const randomBtn = document.getElementById('random-btn');

        // Demo state
        let demoInterval = null;
        let currentMode = 'scenarios'; // 'scenarios' or 'random'
        let scenarioIndex = 0;

        // Test scenarios (lidar values in centimeters to match Firebase data)
        const testScenarios = [
            // Normal operation
            { tilt_side: 5.0, tilt_fb: 2.0, lidar: 300, light: 1500, accel_x: 1.2 },
            // Side tilt warning
            { tilt_side: 35.0, tilt_fb: 3.0, lidar: 250, light: 1200, accel_x: 2.1 },
            // Pitch tilt warning
            { tilt_side: 8.0, tilt_fb: 12.0, lidar: 200, light: 1100, accel_x: 3.5 },
            // Obstacle warning
            { tilt_side: 5.0, tilt_fb: 3.0, lidar: 120, light: 1300, accel_x: 0.8 },
            // Low light (fog light)
            { tilt_side: 2.0, tilt_fb: 1.0, lidar: 280, light: 800, accel_x: 1.0 },
            // High acceleration warning
            { tilt_side: 5.0, tilt_fb: 3.0, lidar: 250, light: 1200, accel_x: 3.5 },
            // Multiple warnings
            { tilt_side: 40.0, tilt_fb: 11.0, lidar: 100, light: 500, accel_x: 8.5 }
        ];

        // Generate random sensor data
        function generateRandomSensorData() {
            return {
                tilt_side: (Math.random() - 0.5) * 90,  // -45 to +45 degrees
                tilt_fb: (Math.random() - 0.5) * 30,    // -15 to +15 degrees
                lidar: Math.random() * 450 + 50,        // 50 to 500 centimeters
                light: Math.random() * 2000,             // 0 to 2000 lux
                accel_x: (Math.random() - 0.5) * 20     // -10 to +10 m/s²
            };
        }

        // Calculate actuators and warnings (same logic as Python)
        function calculateActuatorsAndWarnings(sensorData) {
            let buzzer = false;
            let warning_light = false;
            let fog_light = false;
            let warnings = [];

            // Check side tilt (roll)
            if (Math.abs(sensorData.tilt_side) > 30) {
                buzzer = true;
                warning_light = true;
                warnings.push("Side tilt warning");
            }

            // Check front/back tilt (pitch)
            if (Math.abs(sensorData.tilt_fb) > 9) {
                buzzer = true;
                warning_light = true;
                warnings.push("Pitch tilt warning");
            }

            // Check acceleration
            if (Math.abs(sensorData.accel_x) >= 2.0) {
                buzzer = true;
                warning_light = true;
                warnings.push("High acceleration warning");
            }

            // Check lidar distance (convert from cm to meters for comparison)
            if (sensorData.lidar <= 150) {  // 150 cm = 1.50 meters
                warning_light = true;
                warnings.push("Obstacle detected");
            }

            // Check light level (fog light activates automatically, not a warning)
            if (sensorData.light < 1000) {
                fog_light = true;
                // Note: Fog light activation is not a warning condition
            }

            // Create warning message
            const warning_message = warnings.length > 0 ? warnings.join(" + ") : "";

            return {
                sensors: sensorData,
                actuators: { buzzer, warning_light, fog_light },
                warning: warning_message,
                timestamp: Date.now()
            };
        }

        // Update UI with data
        function updateUI(data) {
            // Update Actuators
            buzzerStatus.classList.toggle('active', data.actuators.buzzer);
            warningLightStatus.classList.toggle('active', data.actuators.warning_light);
            fogLightStatus.classList.toggle('active', data.actuators.fog_light);

            // Update Tilt Visualizers
            const roll = data.sensors.tilt_side;
            const pitch = data.sensors.tilt_fb;

            // Clamp the visual rotation to a reasonable range (-45 to 45 deg)
            const clampedRoll = Math.max(-45, Math.min(45, roll));
            const clampedPitch = Math.max(-45, Math.min(45, pitch));

            // Roll bicycle (front view) - tilts left/right for side tilt
            rollBicycle.style.transform = `rotate(${clampedRoll}deg)`;
            rollValue.textContent = `${roll.toFixed(2)}°`;
            
            // Pitch bicycle (side view) - tilts forward/backward for front/back tilt
            pitchBicycle.style.transform = `rotate(${clampedPitch}deg)`;
            pitchValue.textContent = `${pitch.toFixed(2)}°`;

            // Update other sensor values
            // Convert lidar from centimeters to meters
            const lidarInMeters = data.sensors.lidar / 100;
            lidarValue.innerHTML = `${lidarInMeters.toFixed(2)} <span class="unit">m</span>`;
            lightValue.innerHTML = `${Math.round(data.sensors.light)} <span class="unit">lux</span>`;
            accelValue.innerHTML = `${data.sensors.accel_x.toFixed(2)} <span class="unit">m/s²</span>`;

            // Update Warning Message
            if (data.warning && data.warning.trim() !== "") {
                warningMessage.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${data.warning}`;
                warningCard.classList.add('has-warning');
            } else {
                warningMessage.innerHTML = '<i class="fas fa-check-circle"></i> System nominal. All clear.';
                warningCard.classList.remove('has-warning');
            }

            // Update timestamp
            const timestamp = new Date(data.timestamp);
            lastUpdatedEl.textContent = `Last Updated: ${timestamp.toLocaleString()} (Demo Mode)`;
        }

        // Generate and update data
        function generateData() {
            let sensorData;
            
            if (currentMode === 'scenarios') {
                sensorData = testScenarios[scenarioIndex];
                scenarioIndex = (scenarioIndex + 1) % testScenarios.length;
                console.log(`Demo Scenario ${scenarioIndex}: `, sensorData);
            } else {
                sensorData = generateRandomSensorData();
                console.log('Random Data: ', sensorData);
            }

            const completeData = calculateActuatorsAndWarnings(sensorData);
            updateUI(completeData);
        }

        // Start demo
        function startDemo() {
            if (demoInterval) clearInterval(demoInterval);
            demoInterval = setInterval(generateData, 1000); // Update every second
            startBtn.classList.add('active');
            stopBtn.classList.remove('active');
            generateData(); // Generate first data immediately
        }

        // Stop demo
        function stopDemo() {
            if (demoInterval) {
                clearInterval(demoInterval);
                demoInterval = null;
            }
            startBtn.classList.remove('active');
            stopBtn.classList.add('active');
        }

        // Event listeners
        startBtn.addEventListener('click', startDemo);
        stopBtn.addEventListener('click', stopDemo);
        
        scenarioBtn.addEventListener('click', () => {
            currentMode = 'scenarios';
            scenarioIndex = 0;
            scenarioBtn.classList.add('active');
            randomBtn.classList.remove('active');
            if (demoInterval) generateData(); // Update immediately if running
        });
        
        randomBtn.addEventListener('click', () => {
            currentMode = 'random';
            scenarioBtn.classList.remove('active');
            randomBtn.classList.add('active');
            if (demoInterval) generateData(); // Update immediately if running
        });

        // Initialize demo
        currentMode = 'scenarios';
        scenarioBtn.classList.add('active');
        startDemo();

    </script>
</body>
</html>
